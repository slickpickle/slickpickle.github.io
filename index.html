<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ebird Data Viewer</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

</head>
<body>
    <div id="app">
      <div class="mapWrapper">
        <div class="search-container">
            <input class="searchBar" type="text" v-model="searchQuery" :placeholder="searchPlaceholder" :disabled="isFetching" @focus="showOptions = true" @blur="hideOptions">
            <button v-if="searchQuery" @click="clearSearch">X</button>
            <ul v-if="showOptions" class="options-list">
                <li v-for="(item, index) in filteredList" :key="index" @click="selectDropdown(item)">{{ item.comName }}</li>
            </ul>
        </div>
        <div class="buttonList">
            <button class="searchButton" @click="selectLocalNotables">local notables</button>
            <button class="searchButton" @click="selectNearMeAll">near me</button>
            <button class="searchButton" @click="enableMapClick">click map</button>
            <button class="searchButton" @click="selectHotspots">hotspots</button>
            <button class="searchButton" @click="topMigrators">top migrators</button>
        </div>
        <div class="birdList">
            <div v-for="bird in birdNames" :key="bird.speciesCode">
                <button class="birdButton" @click="onBirdNameClick(bird)">{{ bird.comName }}</button>
            </div>
            <div v-for="bird in migratorNames" :key="bird.speciesCode">
              <button class="birdButton" @click="topMigratorsListClick(bird)">{{ bird.comName }}</button>
          </div>
        </div>
        <input type="range" v-model="sliderValue" min="0" max="30" class="dateSlider" v-show="isSliderVisible">
        <div id="map" ref="mapContainer"></div>
    </div>
    <div v-show="coverScreen" class="cover-screen">Fetching data...</div>
    <div v-show="coverScreenLat" class="cover-screen">{{ latMessage }}</div>
    <div v-show="coverScreenMigrators" class="cover-screen">Fetching data... ({{ fetchProgress }}/{{ totalSpecies }})<br>calculating the 10 species that traveled<br>the farthest north in the last 20 days</div>
    <div v-show="showNoDataMessage" class="no-data-message">No recent sightings</div> 
    </div>
  <style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
    }
    input {
      width: 300px;
    }
    .cover-screen {
        position: fixed; 
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.5); 
        z-index: 1000; 
        display: flex;
        justify-content: center; /* Center horizontally */
        align-items: center; /* Center vertically */
        color: white; /* Adjust text color as needed */
        font-size: 24px; /* Adjust font size as needed */
        font-family: Arial, Helvetica, sans-serif;
    }
    .no-data-message {
      position: fixed; /* Or absolute, depending on your layout */
      top: 50%; /* Center vertically */
      left: 50%; /* Center horizontally */
      transform: translate(-50%, -50%); /* Adjust for exact centering */
      background-color: #003900; /* Example background color */
      color: white; /* Text color */
      padding: 20px;
      border-radius: 8px;
      z-index: 1010; /* Ensure it's above other content */
      font-family: Arial, Helvetica, sans-serif;
    }
    .dateSlider{
      position: absolute;
      left: 50px;
      bottom: 10%;
      z-index: 1000;
      width: 30%;
    }
    @media (max-width:700px){
      .dateSlider {
        width: 50%;
      }
    }
    .birdList {
      position: absolute;
      right: 0px;
      top: 0px;
      height: 97%;
      z-index: 10;
      overflow-y: auto;
      scrollbar-color: rgb(5, 64, 18) #b6ceb7;
    }
    .searchButton {
    padding: 5px;
    margin: 0,5px,5px,5px;
    cursor: pointer;
    background-image: linear-gradient(to top, #D8D9DB 0%, #fff 80%, #FDFDFD 100%);
    border-radius: 10px;
    border: 1px solid #8F9092;
    transition: all 0.2s ease;
    font-family: Arial, Helvetica, sans-serif;
    font-size: 12px;
    font-weight: 600;
    color: #606060;
    text-shadow: 0 1px #fff;
  }
  .search-container button {
    cursor: pointer;
    background-color: Transparent;
    border: none;
    position: absolute;
    right: 5px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 16px;
  }
    .birdButton {
    display: flex;
    align-items: center;
    justify-content: center;
    outline: none;
    padding: 5px;
    margin: 5px;
    cursor: pointer;
    width: 100px;
    background-image: linear-gradient(to top, #D8D9DB 0%, #fff 80%, #FDFDFD 100%);
    border-radius: 10px;
    border: 1px solid #8F9092;
    transition: all 0.2s ease;
    font-family: Arial, Helvetica, sans-serif;
    font-size: 10px;
    font-weight: 600;
    color: #606060;
    text-shadow: 0 1px #fff;
  }
    #app {
        display: flex;
        flex-direction: column;
        height: 100vh;
    }
    .mapWrapper {
      position: relative;
        flex: 1; /* This will make the mapWrapper take up the remaining space */
        width: 100%; /* Ensure full width */
    }
    .buttonList {
        position: absolute;
        left: 60px;
        top: 55px;
        z-index: 100;
        width: 250px;
    }
    button {
      margin-bottom: 5px;
    }
    #map {
        position: absolute;
        left: 0px;
        top: 0px;
        height: 100%;
        width: 100%;
        z-index: 1;
      }
    .search-container {
      position: absolute;
      left: 60px;
      top: 15px;
      z-index: 1000;
    }
    .searchBar{
      border: 1px solid black;
      padding: 5px;
      height: 20px;
      width: 220px;
      border-radius: 5px;
      outline: none;
      color: darkgreen;
      font-weight: bold;
    }
    .searchBar::placeholder{
      color: rgba(1, 62, 4, 0.5);
    }
    .options-list {
      color: rgb(58, 104, 58);
      font-size: 14px;
      font-family: Arial, Helvetica, sans-serif;
      z-index: 1000;
      position: absolute;
      left: 0;
      width: 230px;
      max-height: 200px;
      overflow-y: auto;
      background-color: #fff;
      scrollbar-color: rgb(5, 64, 18) #b6ceb7;
      border-top: none;
      list-style: none;
      padding: 0;
      margin: 0;
      }
      .options-list li {
      padding: 5px;
      cursor: pointer;
      }

    .options-list li:hover {
        background-color: #f0f0f0;
        }
  </style>
<script>
    new Vue({
      el: '#app',
      data() {
        return {
            searchQuery: '',
            selectedSpecies: '',
            apiKey: 'g0gbj09j2s1b', // Replace with your actual API key
            apiURL: '',
            latitude: null,
            longitude: null,
            selectedSpeciesCode: '',
            showOptions: false,
            birdNames: [],
            migratorNames: [],
            migratorNamesMemory: [],
            topMigratorCalled: false,
            coverScreen: false,
            coverScreenMigrators: false,
            coverScreenLat: false,
            latMessage: '',
            showNoDataMessage: false,
            allObservations: [], // Store all fetched observations here
            sliderValue: 30,
            searchPlaceholder: 'Select a bird',
            isFetching: false,
            isSliderVisible: false,
            handleMapClick: false,
            selectionCircle: null,
            birdButtonClick: false,
            fetchProgress: 0,  // Number of completed fetches
            totalSpecies: 0,   // Total number of species to fetch
            uniqueBirds: new Map(),
            speciesArray: [{"speciesCode": "acowoo","comName": "Acorn Woodpecker"},{"speciesCode": "afcdov1","comName": "African Collared-Dove"},{"speciesCode": "aldfly","comName": "Alder Flycatcher"},{"speciesCode": "allhum","comName": "Allen's Hummingbird"},{"speciesCode": "ameavo","comName": "American Avocet"},{"speciesCode": "amebit","comName": "American Bittern"},{"speciesCode": "ambduc","comName": "American Black Duck"},{"speciesCode": "y00475","comName": "American Coot"},{"speciesCode": "amecro","comName": "American Crow"},{"speciesCode": "amedip","comName": "American Dipper"},{"speciesCode": "grefla2","comName": "American Flamingo"},{"speciesCode": "amgplo","comName": "American Golden-Plover"},{"speciesCode": "amegfi","comName": "American Goldfinch"},{"speciesCode": "norgos","comName": "American Goshawk"},{"speciesCode": "amekes","comName": "American Kestrel"},{"speciesCode": "amepip","comName": "American Pipit"},{"speciesCode": "amered","comName": "American Redstart"},{"speciesCode": "amerob","comName": "American Robin"},{"speciesCode": "attwoo1","comName": "American Three-toed Woodpecker"},{"speciesCode": "amtspa","comName": "American Tree Sparrow"},{"speciesCode": "amwpel","comName": "American White Pelican"},{"speciesCode": "amewig","comName": "American Wigeon"},{"speciesCode": "ancmur","comName": "Ancient Murrelet"},{"speciesCode": "annhum","comName": "Anna's Hummingbird"},{"speciesCode": "antalb1","comName": "Antipodean Albatross"},{"speciesCode": "arcloo","comName": "Arctic Loon"},{"speciesCode": "arcter","comName": "Arctic Tern"},{"speciesCode": "astfly","comName": "Ash-throated Flycatcher"},{"speciesCode": "asspet","comName": "Ashy Storm-Petrel"},{"speciesCode": "baitea","comName": "Baikal Teal"},{"speciesCode": "baisan","comName": "Baird's Sandpiper"},{"speciesCode": "baleag","comName": "Bald Eagle"},{"speciesCode": "balori","comName": "Baltimore Oriole"},{"speciesCode": "batpig1","comName": "Band-tailed Pigeon"},{"speciesCode": "banswa","comName": "Bank Swallow"},{"speciesCode": "bahgoo","comName": "Bar-headed Goose"},{"speciesCode": "batgod","comName": "Bar-tailed Godwit"},{"speciesCode": "brnowl","comName": "Barn Owl"},{"speciesCode": "barswa","comName": "Barn Swallow"},{"speciesCode": "bargoo","comName": "Barnacle Goose"},{"speciesCode": "brdowl","comName": "Barred Owl"},{"speciesCode": "bargol","comName": "Barrow's Goldeneye"},{"speciesCode": "babwar","comName": "Bay-breasted Warbler"},{"speciesCode": "belvir","comName": "Bell's Vireo"},{"speciesCode": "belkin1","comName": "Belted Kingfisher"},{"speciesCode": "bewwre","comName": "Bewick's Wren"},{"speciesCode": "blkoys","comName": "Black Oystercatcher"},{"speciesCode": "blkpho","comName": "Black Phoebe"},{"speciesCode": "bkrfin","comName": "Black Rosy-Finch"},{"speciesCode": "blksco2","comName": "Black Scoter"},{"speciesCode": "blkski","comName": "Black Skimmer"},{"speciesCode": "bkspet","comName": "Black Storm-Petrel"},{"speciesCode": "blkswa","comName": "Black Swan"},{"speciesCode": "blkswi","comName": "Black Swift"},{"speciesCode": "blkter","comName": "Black Tern"},{"speciesCode": "blktur","comName": "Black Turnstone"},{"speciesCode": "blkvul","comName": "Black Vulture"},{"speciesCode": "bawwar","comName": "Black-and-white Warbler"},{"speciesCode": "bkbwoo","comName": "Black-backed Woodpecker"},{"speciesCode": "bkbplo","comName": "Black-bellied Plover"},{"speciesCode": "bbwduc","comName": "Black-bellied Whistling-Duck"},{"speciesCode": "bkbmag1","comName": "Black-billed Magpie"},{"speciesCode": "bkcchi","comName": "Black-capped Chickadee"},{"speciesCode": "bkchum","comName": "Black-chinned Hummingbird"},{"speciesCode": "bkcspa","comName": "Black-chinned Sparrow"},{"speciesCode": "bcnher","comName": "Black-crowned Night Heron"},{"speciesCode": "bkfalb","comName": "Black-footed Albatross"},{"speciesCode": "bkhgro","comName": "Black-headed Grosbeak"},{"speciesCode": "bkhgul","comName": "Black-headed Gull"},{"speciesCode": "bklkit","comName": "Black-legged Kittiwake"},{"speciesCode": "bknsti","comName": "Black-necked Stilt"},{"speciesCode": "btbwar","comName": "Black-throated Blue Warbler"},{"speciesCode": "btywar","comName": "Black-throated Gray Warbler"},{"speciesCode": "btnwar","comName": "Black-throated Green Warbler"},{"speciesCode": "bktspa","comName": "Black-throated Sparrow"},{"speciesCode": "bkvshe","comName": "Black-vented Shearwater"},{"speciesCode": "bkbwar","comName": "Blackburnian Warbler"},{"speciesCode": "bkpwar","comName": "Blackpoll Warbler"},{"speciesCode": "blugrb1","comName": "Blue Grosbeak"},{"speciesCode": "blujay","comName": "Blue Jay"},{"speciesCode": "bfoboo","comName": "Blue-footed Booby"},{"speciesCode": "buggna","comName": "Blue-gray Gnatcatcher"},{"speciesCode": "buhvir","comName": "Blue-headed Vireo"},{"speciesCode": "buwtea","comName": "Blue-winged Teal"},{"speciesCode": "buwwar","comName": "Blue-winged Warbler"},{"speciesCode": "boboli","comName": "Bobolink"},{"speciesCode": "bongul","comName": "Bonaparte's Gull"},{"speciesCode": "borowl","comName": "Boreal Owl"},{"speciesCode": "brambl","comName": "Brambling"},{"speciesCode": "bracor","comName": "Brandt's Cormorant"},{"speciesCode": "brant","comName": "Brant"},{"speciesCode": "brebla","comName": "Brewer's Blackbird"},{"speciesCode": "brespa","comName": "Brewer's Sparrow"},{"speciesCode": "brtcur","comName": "Bristle-thighed Curlew"},{"speciesCode": "brbhum","comName": "Broad-billed Hummingbird"},{"speciesCode": "brthum","comName": "Broad-tailed Hummingbird"},{"speciesCode": "brwhaw","comName": "Broad-winged Hawk"},{"speciesCode": "brnboo","comName": "Brown Booby"},{"speciesCode": "brncre","comName": "Brown Creeper"},{"speciesCode": "brnpel","comName": "Brown Pelican"},{"speciesCode": "brnthr","comName": "Brown Thrasher"},{"speciesCode": "bnhcow","comName": "Brown-headed Cowbird"},{"speciesCode": "budger","comName": "Budgerigar"},{"speciesCode": "bubsan","comName": "Buff-breasted Sandpiper"},{"speciesCode": "buffle","comName": "Bufflehead"},{"speciesCode": "bulshe","comName": "Buller's Shearwater"},{"speciesCode": "bulori","comName": "Bullock's Oriole"},{"speciesCode": "burowl","comName": "Burrowing Owl"},{"speciesCode": "bushti","comName": "Bushtit"},{"speciesCode": "cacgoo1","comName": "Cackling Goose"},{"speciesCode": "calcon","comName": "California Condor"},{"speciesCode": "calgul","comName": "California Gull"},{"speciesCode": "calqua","comName": "California Quail"},{"speciesCode": "cowscj1","comName": "California Scrub-Jay"},{"speciesCode": "calthr","comName": "California Thrasher"},{"speciesCode": "caltow","comName": "California Towhee"},{"speciesCode": "calhum","comName": "Calliope Hummingbird"},{"speciesCode": "cangoo","comName": "Canada Goose"},{"speciesCode": "gryjay","comName": "Canada Jay"},{"speciesCode": "canwar","comName": "Canada Warbler"},{"speciesCode": "canvas","comName": "Canvasback"},{"speciesCode": "canwre","comName": "Canyon Wren"},{"speciesCode": "camwar","comName": "Cape May Warbler"},{"speciesCode": "caster1","comName": "Caspian Tern"},{"speciesCode": "casauk","comName": "Cassin's Auklet"},{"speciesCode": "casfin","comName": "Cassin's Finch"},{"speciesCode": "caskin","comName": "Cassin's Kingbird"},{"speciesCode": "casspa","comName": "Cassin's Sparrow"},{"speciesCode": "casvir","comName": "Cassin's Vireo"},{"speciesCode": "cavswa","comName": "Cave Swallow"},{"speciesCode": "chbchi","comName": "Chestnut-backed Chickadee"},{"speciesCode": "chclon","comName": "Chestnut-collared Longspur"},{"speciesCode": "chswar","comName": "Chestnut-sided Warbler"},{"speciesCode": "chiswi","comName": "Chimney Swift"},{"speciesCode": "chispa","comName": "Chipping Sparrow"},{"speciesCode": "chukar","comName": "Chukar"},{"speciesCode": "cintea","comName": "Cinnamon Teal"},{"speciesCode": "clagre","comName": "Clark's Grebe"},{"speciesCode": "clanut","comName": "Clark's Nutcracker"},{"speciesCode": "clcspa","comName": "Clay-colored Sparrow"},{"speciesCode": "cliswa","comName": "Cliff Swallow"},{"speciesCode": "cockat","comName": "Cockatiel"},{"speciesCode": "comcra","comName": "Common Crane"},{"speciesCode": "comeid","comName": "Common Eider"},{"speciesCode": "comgal1","comName": "Common Gallinule"},{"speciesCode": "comgol","comName": "Common Goldeneye"},{"speciesCode": "comgra","comName": "Common Grackle"},{"speciesCode": "cogdov","comName": "Common Ground Dove"},{"speciesCode": "comloo","comName": "Common Loon"},{"speciesCode": "commer","comName": "Common Merganser"},{"speciesCode": "commur","comName": "Common Murre"},{"speciesCode": "comnig","comName": "Common Nighthawk"},{"speciesCode": "compoo","comName": "Common Poorwill"},{"speciesCode": "comrav","comName": "Common Raven"},{"speciesCode": "comred","comName": "Common Redpoll"},{"speciesCode": "blksco1","comName": "Common Scoter"},{"speciesCode": "comter","comName": "Common Tern"},{"speciesCode": "comyel","comName": "Common Yellowthroat"},{"speciesCode": "coopet","comName": "Cook's Petrel"},{"speciesCode": "coohaw","comName": "Cooper's Hawk"},{"speciesCode": "coshum","comName": "Costa's Hummingbird"},{"speciesCode": "y00678","comName": "Crested Caracara"},{"speciesCode": "cursan","comName": "Curlew Sandpiper"},{"speciesCode": "cubthr","comName": "Curve-billed Thrasher"},{"speciesCode": "daejun","comName": "Dark-eyed Junco"},{"speciesCode": "dickci","comName": "Dickcissel"},{"speciesCode": "doccor","comName": "Double-crested Cormorant"},{"speciesCode": "dowwoo","comName": "Downy Woodpecker"},{"speciesCode": "dunlin","comName": "Dunlin"},{"speciesCode": "dusfly","comName": "Dusky Flycatcher"},{"speciesCode": "dusgro","comName": "Dusky Grouse"},{"speciesCode": "dusthr2","comName": "Dusky Thrush"},{"speciesCode": "duswar","comName": "Dusky Warbler"},{"speciesCode": "ducfly","comName": "Dusky-capped Flycatcher"},{"speciesCode": "eargre","comName": "Eared Grebe"},{"speciesCode": "easblu","comName": "Eastern Bluebird"},{"speciesCode": "easkin","comName": "Eastern Kingbird"},{"speciesCode": "easpho","comName": "Eastern Phoebe"},{"speciesCode": "eastow","comName": "Eastern Towhee"},{"speciesCode": "easwpw1","comName": "Eastern Whip-poor-will"},{"speciesCode": "eawpew","comName": "Eastern Wood-Pewee"},{"speciesCode": "eaywag","comName": "Eastern Yellow Wagtail"},{"speciesCode": "egygoo","comName": "Egyptian Goose"},{"speciesCode": "eleter1","comName": "Elegant Tern"},{"speciesCode": "empgoo","comName": "Emperor Goose"},{"speciesCode": "eucdov","comName": "Eurasian Collared-Dove"},{"speciesCode": "eurdot","comName": "Eurasian Dotterel"},{"speciesCode": "skylar","comName": "Eurasian Skylark"},{"speciesCode": "eurwig","comName": "Eurasian Wigeon"},{"speciesCode": "eurgol","comName": "European Goldfinch"},{"speciesCode": "eursta","comName": "European Starling"},{"speciesCode": "evegro","comName": "Evening Grosbeak"},{"speciesCode": "falduc","comName": "Falcated Duck"},{"speciesCode": "ferhaw","comName": "Ferruginous Hawk"},{"speciesCode": "fiespa","comName": "Field Sparrow"},{"speciesCode": "flaowl","comName": "Flammulated Owl"},{"speciesCode": "flfshe","comName": "Flesh-footed Shearwater"},{"speciesCode": "ftspet","comName": "Fork-tailed Storm-Petrel"},{"speciesCode": "forter","comName": "Forster's Tern"},{"speciesCode": "foxspa","comName": "Fox Sparrow"},{"speciesCode": "fragul","comName": "Franklin's Gull"},{"speciesCode": "fuwduc","comName": "Fulvous Whistling-Duck"},{"speciesCode": "gadwal","comName": "Gadwall"},{"speciesCode": "gamqua","comName": "Gambel's Quail"},{"speciesCode": "gargan","comName": "Garganey"},{"speciesCode": "glagul","comName": "Glaucous Gull"},{"speciesCode": "glwgul","comName": "Glaucous-winged Gull"},{"speciesCode": "gloibi","comName": "Glossy Ibis"},{"speciesCode": "goleag","comName": "Golden Eagle"},{"speciesCode": "golphe","comName": "Golden Pheasant"},{"speciesCode": "gockin","comName": "Golden-crowned Kinglet"},{"speciesCode": "gocspa","comName": "Golden-crowned Sparrow"},{"speciesCode": "gowwar","comName": "Golden-winged Warbler"},{"speciesCode": "graspa","comName": "Grasshopper Sparrow"},{"speciesCode": "grycat","comName": "Gray Catbird"},{"speciesCode": "gryfly","comName": "Gray Flycatcher"},{"speciesCode": "grepar","comName": "Gray Parrot"},{"speciesCode": "grypar","comName": "Gray Partridge"},{"speciesCode": "gycthr","comName": "Gray-cheeked Thrush"},{"speciesCode": "gcrfin","comName": "Gray-crowned Rosy-Finch"},{"speciesCode": "gragoo","comName": "Graylag Goose"},{"speciesCode": "grbher3","comName": "Great Blue Heron"},{"speciesCode": "grcfly","comName": "Great Crested Flycatcher"},{"speciesCode": "greegr","comName": "Great Egret"},{"speciesCode": "grgowl","comName": "Great Gray Owl"},{"speciesCode": "grhowl","comName": "Great Horned Owl"},{"speciesCode": "grekno","comName": "Great Knot"},{"speciesCode": "greshe","comName": "Great Shearwater"},{"speciesCode": "grtgra","comName": "Great-tailed Grackle"},{"speciesCode": "greroa","comName": "Greater Roadrunner"},{"speciesCode": "saggro","comName": "Greater Sage-Grouse"},{"speciesCode": "gresca","comName": "Greater Scaup"},{"speciesCode": "gwfgoo","comName": "Greater White-fronted Goose"},{"speciesCode": "greyel","comName": "Greater Yellowlegs"},{"speciesCode": "grnher","comName": "Green Heron"},{"speciesCode": "rinphe2","comName": "Green Pheasant"},{"speciesCode": "gnttow","comName": "Green-tailed Towhee"},{"speciesCode": "gnwtea","comName": "Green-winged Teal"},{"speciesCode": "xanmur1","comName": "Guadalupe Murrelet"},{"speciesCode": "gyrfal","comName": "Gyrfalcon"},{"speciesCode": "haiwoo","comName": "Hairy Woodpecker"},{"speciesCode": "hamfly","comName": "Hammond's Flycatcher"},{"speciesCode": "harduc","comName": "Harlequin Duck"},{"speciesCode": "hrshaw","comName": "Harris's Hawk"},{"speciesCode": "harspa","comName": "Harris's Sparrow"},{"speciesCode": "hawpet1","comName": "Hawaiian Petrel"},{"speciesCode": "heegul","comName": "Heermann's Gull"},{"speciesCode": "helgui","comName": "Helmeted Guineafowl"},{"speciesCode": "herthr","comName": "Hermit Thrush"},{"speciesCode": "herwar","comName": "Hermit Warbler"},{"speciesCode": "hergul","comName": "Herring Gull"},{"speciesCode": "hoared","comName": "Hoary Redpoll"},{"speciesCode": "hoomer","comName": "Hooded Merganser"},{"speciesCode": "hooori","comName": "Hooded Oriole"},{"speciesCode": "hoowar","comName": "Hooded Warbler"},{"speciesCode": "horgre","comName": "Horned Grebe"},{"speciesCode": "horlar","comName": "Horned Lark"},{"speciesCode": "horpuf","comName": "Horned Puffin"},{"speciesCode": "houfin","comName": "House Finch"},{"speciesCode": "houspa","comName": "House Sparrow"},{"speciesCode": "houwre","comName": "House Wren"},{"speciesCode": "hudgod","comName": "Hudsonian Godwit"},{"speciesCode": "hutvir","comName": "Hutton's Vireo"},{"speciesCode": "y00478","comName": "Iceland Gull"},{"speciesCode": "compea","comName": "Indian Peafowl"},{"speciesCode": "indbun","comName": "Indigo Bunting"},{"speciesCode": "jacsni","comName": "Jack Snipe"},{"speciesCode": "jufpet","comName": "Juan Fernandez Petrel"},{"speciesCode": "juntit1","comName": "Juniper Titmouse"},{"speciesCode": "kenwar","comName": "Kentucky Warbler"},{"speciesCode": "killde","comName": "Killdeer"},{"speciesCode": "kineid","comName": "King Eider"},{"speciesCode": "lanfal1","comName": "Lanner Falcon"},{"speciesCode": "laplon","comName": "Lapland Longspur"},{"speciesCode": "larbun","comName": "Lark Bunting"},{"speciesCode": "larspa","comName": "Lark Sparrow"},{"speciesCode": "laugul","comName": "Laughing Gull"},{"speciesCode": "lawgol","comName": "Lawrence's Goldfinch"},{"speciesCode": "layalb","comName": "Laysan Albatross"},{"speciesCode": "lazbun","comName": "Lazuli Bunting"},{"speciesCode": "lcspet","comName": "Leach's Storm-Petrel"},{"speciesCode": "leabit","comName": "Least Bittern"},{"speciesCode": "leafly","comName": "Least Flycatcher"},{"speciesCode": "leasan","comName": "Least Sandpiper"},{"speciesCode": "leater1","comName": "Least Tern"},{"speciesCode": "lecspa","comName": "LeConte's Sparrow"},{"speciesCode": "lbbgul","comName": "Lesser Black-backed Gull"},{"speciesCode": "lesgol","comName": "Lesser Goldfinch"},{"speciesCode": "lesnig","comName": "Lesser Nighthawk"},{"speciesCode": "lessca","comName": "Lesser Scaup"},{"speciesCode": "lesyel","comName": "Lesser Yellowlegs"},{"speciesCode": "lewwoo","comName": "Lewis's Woodpecker"},{"speciesCode": "linspa","comName": "Lincoln's Sparrow"},{"speciesCode": "libher","comName": "Little Blue Heron"},{"speciesCode": "litbun","comName": "Little Bunting"},{"speciesCode": "litgul","comName": "Little Gull"},{"speciesCode": "litsti","comName": "Little Stint"},{"speciesCode": "logshr","comName": "Loggerhead Shrike"},{"speciesCode": "lobcur","comName": "Long-billed Curlew"},{"speciesCode": "lobdow","comName": "Long-billed Dowitcher"},{"speciesCode": "lobmur","comName": "Long-billed Murrelet"},{"speciesCode": "loeowl","comName": "Long-eared Owl"},{"speciesCode": "lotduc","comName": "Long-tailed Duck"},{"speciesCode": "lotjae","comName": "Long-tailed Jaeger"},{"speciesCode": "lotsti","comName": "Long-toed Stint"},{"speciesCode": "louwat","comName": "Louisiana Waterthrush"},{"speciesCode": "lucwar","comName": "Lucy's Warbler"},{"speciesCode": "macwar","comName": "MacGillivray's Warbler"},{"speciesCode": "magfri","comName": "Magnificent Frigatebird"},{"speciesCode": "magwar","comName": "Magnolia Warbler"},{"speciesCode": "mallar3","comName": "Mallard"},{"speciesCode": "manduc","comName": "Mandarin Duck"},{"speciesCode": "manshe","comName": "Manx Shearwater"},{"speciesCode": "margod","comName": "Marbled Godwit"},{"speciesCode": "marmur","comName": "Marbled Murrelet"},{"speciesCode": "marwre","comName": "Marsh Wren"},{"speciesCode": "mckbun","comName": "McKay's Bunting"},{"speciesCode": "merlin","comName": "Merlin"},{"speciesCode": "monpar","comName": "Monk Parakeet"},{"speciesCode": "motpet","comName": "Mottled Petrel"},{"speciesCode": "moublu","comName": "Mountain Bluebird"},{"speciesCode": "mouchi","comName": "Mountain Chickadee"},{"speciesCode": "mouplo","comName": "Mountain Plover"},{"speciesCode": "mouqua","comName": "Mountain Quail"},{"speciesCode": "moudov","comName": "Mourning Dove"},{"speciesCode": "mouwar","comName": "Mourning Warbler"},{"speciesCode": "murpet","comName": "Murphy's Petrel"},{"speciesCode": "musduc","comName": "Muscovy Duck"},{"speciesCode": "mutswa","comName": "Mute Swan"},{"speciesCode": "naswar","comName": "Nashville Warbler"},{"speciesCode": "nazboo1","comName": "Nazca Booby"},{"speciesCode": "norbob","comName": "Northern Bobwhite"},{"speciesCode": "norfli","comName": "Northern Flicker"},{"speciesCode": "norful","comName": "Northern Fulmar"},{"speciesCode": "norhar2","comName": "Northern Harrier"},{"speciesCode": "nohowl","comName": "Northern Hawk Owl"},{"speciesCode": "normoc","comName": "Northern Mockingbird"},{"speciesCode": "norpar","comName": "Northern Parula"},{"speciesCode": "norpin","comName": "Northern Pintail"},{"speciesCode": "nopowl","comName": "Northern Pygmy-Owl"},{"speciesCode": "orabis1","comName": "Northern Red Bishop"},{"speciesCode": "nrwswa","comName": "Northern Rough-winged Swallow"},{"speciesCode": "nswowl","comName": "Northern Saw-whet Owl"},{"speciesCode": "norsho","comName": "Northern Shoveler"},{"speciesCode": "norshr4","comName": "Northern Shrike"},{"speciesCode": "norwat","comName": "Northern Waterthrush"},{"speciesCode": "norwhe","comName": "Northern Wheatear"},{"speciesCode": "nutwoo","comName": "Nuttall's Woodpecker"},{"speciesCode": "oaktit","comName": "Oak Titmouse"},{"speciesCode": "olsfly","comName": "Olive-sided Flycatcher"},{"speciesCode": "orcwar","comName": "Orange-crowned Warbler"},{"speciesCode": "orcori","comName": "Orchard Oriole"},{"speciesCode": "origre","comName": "Oriental Greenfinch"},{"speciesCode": "osprey","comName": "Osprey"},{"speciesCode": "ovenbi1","comName": "Ovenbird"},{"speciesCode": "pagplo","comName": "Pacific Golden-Plover"},{"speciesCode": "pacloo","comName": "Pacific Loon"},{"speciesCode": "pacwre1","comName": "Pacific Wren"},{"speciesCode": "paibun","comName": "Painted Bunting"},{"speciesCode": "paired","comName": "Painted Redstart"},{"speciesCode": "palwar","comName": "Palm Warbler"},{"speciesCode": "parauk","comName": "Parakeet Auklet"},{"speciesCode": "parjae","comName": "Parasitic Jaeger"},{"speciesCode": "pecsan","comName": "Pectoral Sandpiper"},{"speciesCode": "pelcor","comName": "Pelagic Cormorant"},{"speciesCode": "perfal","comName": "Peregrine Falcon"},{"speciesCode": "phaino","comName": "Phainopepla"},{"speciesCode": "phivir","comName": "Philadelphia Vireo"},{"speciesCode": "pibgre","comName": "Pied-billed Grebe"},{"speciesCode": "piggui","comName": "Pigeon Guillemot"},{"speciesCode": "pilwoo","comName": "Pileated Woodpecker"},{"speciesCode": "pingro","comName": "Pine Grosbeak"},{"speciesCode": "pinsis","comName": "Pine Siskin"},{"speciesCode": "pinwar","comName": "Pine Warbler"},{"speciesCode": "pifshe","comName": "Pink-footed Shearwater"},{"speciesCode": "pinjay","comName": "Pinyon Jay"},{"speciesCode": "pipplo","comName": "Piping Plover"},{"speciesCode": "plsvir","comName": "Plumbeous Vireo"},{"speciesCode": "pomjae","comName": "Pomarine Jaeger"},{"speciesCode": "prafal","comName": "Prairie Falcon"},{"speciesCode": "prawar","comName": "Prairie Warbler"},{"speciesCode": "prowar","comName": "Prothonotary Warbler"},{"speciesCode": "purfin","comName": "Purple Finch"},{"speciesCode": "purmar","comName": "Purple Martin"},{"speciesCode": "redcro","comName": "Red Crossbill"},{"speciesCode": "redjun","comName": "Red Junglefowl"},{"speciesCode": "redkno","comName": "Red Knot"},{"speciesCode": "redpha1","comName": "Red Phalarope"},{"speciesCode": "rebwoo","comName": "Red-bellied Woodpecker"},{"speciesCode": "rebtro","comName": "Red-billed Tropicbird"},{"speciesCode": "rebgoo1","comName": "Red-breasted Goose"},{"speciesCode": "rebmer","comName": "Red-breasted Merganser"},{"speciesCode": "rebnut","comName": "Red-breasted Nuthatch"},{"speciesCode": "rebsap","comName": "Red-breasted Sapsucker"},{"speciesCode": "reevir1","comName": "Red-eyed Vireo"},{"speciesCode": "refblu","comName": "Red-flanked Bluetail"},{"speciesCode": "refboo","comName": "Red-footed Booby"},{"speciesCode": "rehwoo","comName": "Red-headed Woodpecker"},{"speciesCode": "relkit","comName": "Red-legged Kittiwake"},{"speciesCode": "relpar1","comName": "Red-legged Partridge"},{"speciesCode": "rensap","comName": "Red-naped Sapsucker"},{"speciesCode": "rengre","comName": "Red-necked Grebe"},{"speciesCode": "renpha","comName": "Red-necked Phalarope"},{"speciesCode": "rensti","comName": "Red-necked Stint"},{"speciesCode": "reshaw","comName": "Red-shouldered Hawk"},{"speciesCode": "rethaw","comName": "Red-tailed Hawk"},{"speciesCode": "retloo","comName": "Red-throated Loon"},{"speciesCode": "retpip","comName": "Red-throated Pipit"},{"speciesCode": "rewbla","comName": "Red-winged Blackbird"},{"speciesCode": "redhea","comName": "Redhead"},{"speciesCode": "reephe1","comName": "Reeves's Pheasant"},{"speciesCode": "rhiauk","comName": "Rhinoceros Auklet"},{"speciesCode": "ribgul","comName": "Ring-billed Gull"},{"speciesCode": "rinduc","comName": "Ring-necked Duck"},{"speciesCode": "rinphe1","comName": "Ring-necked Pheasant"},{"speciesCode": "rintea1","comName": "Ringed Teal"},{"speciesCode": "rocpig","comName": "Rock Pigeon"},{"speciesCode": "rocsan","comName": "Rock Sandpiper"},{"speciesCode": "rocwre","comName": "Rock Wren"},{"speciesCode": "robgro","comName": "Rose-breasted Grosbeak"},{"speciesCode": "rosgoo","comName": "Ross's Goose"},{"speciesCode": "rosgul","comName": "Ross's Gull"},{"speciesCode": "peflov","comName": "Rosy-faced Lovebird"},{"speciesCode": "rolhaw","comName": "Rough-legged Hawk"},{"speciesCode": "ruckin","comName": "Ruby-crowned Kinglet"},{"speciesCode": "rthhum","comName": "Ruby-throated Hummingbird"},{"speciesCode": "rudduc","comName": "Ruddy Duck"},{"speciesCode": "rudshe","comName": "Ruddy Shelduck"},{"speciesCode": "rudtur","comName": "Ruddy Turnstone"},{"speciesCode": "ruff","comName": "Ruff"},{"speciesCode": "rufgro","comName": "Ruffed Grouse"},{"speciesCode": "rufhum","comName": "Rufous Hummingbird"},{"speciesCode": "rusbun","comName": "Rustic Bunting"},{"speciesCode": "rusbla","comName": "Rusty Blackbird"},{"speciesCode": "sabgul","comName": "Sabine's Gull"},{"speciesCode": "sagthr","comName": "Sage Thrasher"},{"speciesCode": "sagspa1","comName": "Sagebrush Sparrow"},{"speciesCode": "sander","comName": "Sanderling"},{"speciesCode": "sancra","comName": "Sandhill Crane"},{"speciesCode": "savspa","comName": "Savannah Sparrow"},{"speciesCode": "saypho","comName": "Say's Phoebe"},{"speciesCode": "nutman","comName": "Scaly-breasted Munia"},{"speciesCode": "scatan","comName": "Scarlet Tanager"},{"speciesCode": "sctfly","comName": "Scissor-tailed Flycatcher"},{"speciesCode": "scoori","comName": "Scott's Oriole"},{"speciesCode": "xanmur2","comName": "Scripps's Murrelet"},{"speciesCode": "sedwre1","comName": "Sedge Wren"},{"speciesCode": "semplo","comName": "Semipalmated Plover"},{"speciesCode": "semsan","comName": "Semipalmated Sandpiper"},{"speciesCode": "shshaw","comName": "Sharp-shinned Hawk"},{"speciesCode": "shtgro","comName": "Sharp-tailed Grouse"},{"speciesCode": "shtsan","comName": "Sharp-tailed Sandpiper"},{"speciesCode": "shbdow","comName": "Short-billed Dowitcher"},{"speciesCode": "mewgul2","comName": "Short-billed Gull"},{"speciesCode": "sheowl","comName": "Short-eared Owl"},{"speciesCode": "shtalb","comName": "Short-tailed Albatross"},{"speciesCode": "shtshe","comName": "Short-tailed Shearwater"},{"speciesCode": "lessap2","comName": "Siberian Sand-Plover"},{"speciesCode": "slbgul","comName": "Slaty-backed Gull"},{"speciesCode": "smew","comName": "Smew"},{"speciesCode": "smilon","comName": "Smith's Longspur"},{"speciesCode": "snobun","comName": "Snow Bunting"},{"speciesCode": "snogoo","comName": "Snow Goose"},{"speciesCode": "snoegr","comName": "Snowy Egret"},{"speciesCode": "snoowl1","comName": "Snowy Owl"},{"speciesCode": "snoplo5","comName": "Snowy Plover"},{"speciesCode": "solsan","comName": "Solitary Sandpiper"},{"speciesCode": "sonspa","comName": "Song Sparrow"},{"speciesCode": "soogro1","comName": "Sooty Grouse"},{"speciesCode": "sooshe","comName": "Sooty Shearwater"},{"speciesCode": "sora","comName": "Sora"},{"speciesCode": "sopsku1","comName": "South Polar Skua"},{"speciesCode": "spoowl","comName": "Spotted Owl"},{"speciesCode": "spored","comName": "Spotted Redshank"},{"speciesCode": "sposan","comName": "Spotted Sandpiper"},{"speciesCode": "spotow","comName": "Spotted Towhee"},{"speciesCode": "sprpip","comName": "Sprague's Pipit"},{"speciesCode": "sprgro","comName": "Spruce Grouse"},{"speciesCode": "stepet","comName": "Stejneger's Petrel"},{"speciesCode": "steeid","comName": "Steller's Eider"},{"speciesCode": "stejay","comName": "Steller's Jay"},{"speciesCode": "stisan","comName": "Stilt Sandpiper"},{"speciesCode": "stbori","comName": "Streak-backed Oriole"},{"speciesCode": "strshe","comName": "Streaked Shearwater"},{"speciesCode": "sumtan","comName": "Summer Tanager"},{"speciesCode": "sursco","comName": "Surf Scoter"},{"speciesCode": "surfbi","comName": "Surfbird"},{"speciesCode": "swahaw","comName": "Swainson's Hawk"},{"speciesCode": "swathr","comName": "Swainson's Thrush"},{"speciesCode": "swaspa","comName": "Swamp Sparrow"},{"speciesCode": "swagoo1","comName": "Swan Goose"},{"speciesCode": "tenwar","comName": "Tennessee Warbler"},{"speciesCode": "mcclon","comName": "Thick-billed Longspur"},{"speciesCode": "thbmur","comName": "Thick-billed Murre"},{"speciesCode": "towsol","comName": "Townsend's Solitaire"},{"speciesCode": "towwar","comName": "Townsend's Warbler"},{"speciesCode": "treswa","comName": "Tree Swallow"},{"speciesCode": "tribla","comName": "Tricolored Blackbird"},{"speciesCode": "triher","comName": "Tricolored Heron"},{"speciesCode": "trokin","comName": "Tropical Kingbird"},{"speciesCode": "truswa","comName": "Trumpeter Swan"},{"speciesCode": "tufduc","comName": "Tufted Duck"},{"speciesCode": "tufpuf","comName": "Tufted Puffin"},{"speciesCode": "tunbeg1","comName": "Tundra Bean-Goose"},{"speciesCode": "tunswa","comName": "Tundra Swan"},{"speciesCode": "turvul","comName": "Turkey Vulture"},{"speciesCode": "uplsan","comName": "Upland Sandpiper"},{"speciesCode": "varthr","comName": "Varied Thrush"},{"speciesCode": "vauswi","comName": "Vaux's Swift"},{"speciesCode": "veery","comName": "Veery"},{"speciesCode": "verfly","comName": "Vermilion Flycatcher"},{"speciesCode": "vesspa","comName": "Vesper Sparrow"},{"speciesCode": "vigswa","comName": "Violet-green Swallow"},{"speciesCode": "virrai","comName": "Virginia Rail"},{"speciesCode": "virwar","comName": "Virginia's Warbler"},{"speciesCode": "wantat1","comName": "Wandering Tattler"},{"speciesCode": "warvir","comName": "Warbling Vireo"},{"speciesCode": "wetshe","comName": "Wedge-tailed Shearwater"},{"speciesCode": "wesblu","comName": "Western Bluebird"},{"speciesCode": "categr1","comName": "Western Cattle Egret"},{"speciesCode": "wesfly","comName": "Western Flycatcher"},{"speciesCode": "wesgre","comName": "Western Grebe"},{"speciesCode": "wesgul","comName": "Western Gull"},{"speciesCode": "weskin","comName": "Western Kingbird"},{"speciesCode": "wesmea","comName": "Western Meadowlark"},{"speciesCode": "wessan","comName": "Western Sandpiper"},{"speciesCode": "wesowl1","comName": "Western Screech-Owl"},{"speciesCode": "westan","comName": "Western Tanager"},{"speciesCode": "wewpew","comName": "Western Wood-Pewee"},{"speciesCode": "whimbr","comName": "Whimbrel"},{"speciesCode": "whiibi","comName": "White Ibis"},{"speciesCode": "whiwag","comName": "White Wagtail"},{"speciesCode": "whbnut","comName": "White-breasted Nuthatch"},{"speciesCode": "whcalb1","comName": "White-capped Albatross"},{"speciesCode": "whcspa","comName": "White-crowned Sparrow"},{"speciesCode": "whevir","comName": "White-eyed Vireo"},{"speciesCode": "whfibi","comName": "White-faced Ibis"},{"speciesCode": "whhwoo","comName": "White-headed Woodpecker"},{"speciesCode": "whrsan","comName": "White-rumped Sandpiper"},{"speciesCode": "whtkit","comName": "White-tailed Kite"},{"speciesCode": "whtpta1","comName": "White-tailed Ptarmigan"},{"speciesCode": "whtspa","comName": "White-throated Sparrow"},{"speciesCode": "whtswi","comName": "White-throated Swift"},{"speciesCode": "whwcro","comName": "White-winged Crossbill"},{"speciesCode": "whwdov","comName": "White-winged Dove"},{"speciesCode": "whwsco2","comName": "White-winged Scoter"},{"speciesCode": "whoswa","comName": "Whooper Swan"},{"speciesCode": "wiltur","comName": "Wild Turkey"},{"speciesCode": "willet1","comName": "Willet"},{"speciesCode": "wilsap","comName": "Williamson's Sapsucker"},{"speciesCode": "wilfly","comName": "Willow Flycatcher"},{"speciesCode": "wilpha","comName": "Wilson's Phalarope"},{"speciesCode": "wilplo","comName": "Wilson's Plover"},{"speciesCode": "wilsni1","comName": "Wilson's Snipe"},{"speciesCode": "wispet","comName": "Wilson's Storm-Petrel"},{"speciesCode": "wlswar","comName": "Wilson's Warbler"},{"speciesCode": "winwre3","comName": "Winter Wren"},{"speciesCode": "wooduc","comName": "Wood Duck"},{"speciesCode": "woosan","comName": "Wood Sandpiper"},{"speciesCode": "woothr","comName": "Wood Thrush"},{"speciesCode": "wooscj2","comName": "Woodhouse's Scrub-Jay"},{"speciesCode": "woewar1","comName": "Worm-eating Warbler"},{"speciesCode": "wrenti","comName": "Wrentit"},{"speciesCode": "yelrai","comName": "Yellow Rail"},{"speciesCode": "yelwar","comName": "Yellow Warbler"},{"speciesCode": "yebfly","comName": "Yellow-bellied Flycatcher"},{"speciesCode": "yebsap","comName": "Yellow-bellied Sapsucker"},{"speciesCode": "yebcuc","comName": "Yellow-billed Cuckoo"},{"speciesCode": "yebloo","comName": "Yellow-billed Loon"},{"speciesCode": "yebcha","comName": "Yellow-breasted Chat"},{"speciesCode": "yeccoc1","comName": "Yellow-crested Cockatoo"},{"speciesCode": "yehbla","comName": "Yellow-headed Blackbird"},{"speciesCode": "yerwar","comName": "Yellow-rumped Warbler"},{"speciesCode": "yetvir","comName": "Yellow-throated Vireo"},{"speciesCode": "yetwar","comName": "Yellow-throated Warbler"},{"speciesCode": "zebfin2","comName": "Zebra Finch"},{"speciesCode": "zothaw","comName": "Zone-tailed Hawk"}]
        };
      },
      watch: {
        sliderValue(newVal) {
          this.updateMapMarkersSlider();
        }
      },
      computed: {
        filteredList() {
          if (!this.speciesArray) return [];
          if (!this.searchQuery) return this.speciesArray; // Show all options if search query is empty
          return this.speciesArray.filter(item =>
            item.comName.toLowerCase().includes(this.searchQuery.toLowerCase())
          );
        }
      },
      mounted() {
        // Call the API when the component is mounted
        /* this.fetchData(); */
        this.map = L.map(this.$refs.mapContainer).setView([40.8, -119.5], 5);
        
        // Add a tile layer
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
          subdomains: 'abcd',
          maxZoom: 20
        }).addTo(this.map);
        this.markerGroup = L.featureGroup().addTo(this.map);
        this.map.on('click', this.mapClickHandler);
      },
      methods: {
        selectDropdown(item) {
          this.birdNames = [];
          this.migratorNames = [];
          this.sliderValue= 30;
          this.coverScreen = true;
          this.markerGroup.clearLayers();
          this.selectedSpecies = item.comName;
          this.selectedSpeciesCode = item.speciesCode; // Store the species code
          this.searchQuery = item.comName; // Set the search input to the common name
          this.showOptions = false; // Hide the options list
          this.allObservations = []; // Clear previous observations

          if (this.selectionCircle) {
                this.map.removeLayer(this.selectionCircle);
                this.selectionCircle = null;
            }


          // Define the API URL, inserting the selected species code dynamically
          this.apiURL = `https://api.ebird.org/v2/data/obs/US-OR/recent/${this.selectedSpeciesCode}?back=30&r=US-ID,US-CA,US-NV,US-WA,US-OR`;
          this.updateMapMarkers();

        },
        hideOptions() {
          // Delay hiding options to allow clicking on options
          setTimeout(() => {
            this.showOptions = false;
          }, 200);
        },
        selectLocalNotables() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                this.latitude = position.coords.latitude;
                this.longitude = position.coords.longitude;
                this.apiURL = `https://api.ebird.org/v2/data/obs/geo/recent/notable?lat=${this.latitude}&lng=${this.longitude}&back=10&dist=50`;
                this.updateMapMarkersLocal()
                }, error => {
                    console.error('Error getting location:', error);
                });
            } else {
                console.log("Geolocation is not supported by this browser.");
            }
        },
        selectNearMeAll() {
          if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                this.latitude = position.coords.latitude;
                this.longitude = position.coords.longitude;
                this.apiURL = `https://api.ebird.org/v2/data/obs/geo/recent?lat=${this.latitude}&lng=${this.longitude}&back=10&dist=50`;
                this.updateMapMarkersLocal()
                }, error => {
                    console.error('Error getting location:', error);
                });
            } else {
                console.log("Geolocation is not supported by this browser.");
            }
        },
        selectHotspots() {
          if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                this.latitude = position.coords.latitude;
                this.longitude = position.coords.longitude;
                this.apiURL = `https://api.ebird.org/v2/ref/hotspot/geo?lat=${this.latitude}&lng=${this.longitude}&back=30&dist=50&fmt=json`;
                this.updateMapMarkersHotspot()
                }, error => {
                    console.error('Error getting location:', error);
                });
            } else {
                console.log("Geolocation is not supported by this browser.");
            }
        },
        onBirdNameClick(bird) {
          this.apiURL = `https://api.ebird.org/v2/data/nearest/geo/recent/${bird.speciesCode}?lat=${this.latitude}&lng=${this.longitude}&back=10&dist=50`
          this.birdButtonClick = true
          this.updateMapMarkersLocal()
        },
        enableMapClick() {
            // Always set handleMapClick to true when the button is clicked
            this.handleMapClick = true;

            // Change the cursor to a crosshair to indicate clickable mode
            this.map.getContainer().style.cursor = 'crosshair';

            // Remove the selection circle if it exists
            if (this.selectionCircle) {
                this.map.removeLayer(this.selectionCircle);
                this.selectionCircle = null;
            }

            // Clear existing markers
            this.markerGroup.clearLayers();
        },
        mapClickHandler(e) {
            // Only proceed if handleMapClick is true
            if (!this.handleMapClick) return;
            this.latitude = e.latlng.lat
            this.longitude = e.latlng.lng
            this.apiURL = `https://api.ebird.org/v2/data/obs/geo/recent?lat=${this.latitude}&lng=${this.longitude}&back=10&dist=50`;
            this.birdButtonClick = false;
            this.updateMapMarkersLocal()
            // Reset handleMapClick to false to prevent additional selections until the button is clicked again
            this.handleMapClick = false;
            // Change the cursor back to default after a selection is made
            this.map.getContainer().style.cursor = '';
        },
        clearSearch() {
          this.birdNames = [];
          this.sliderValue = 30;
          this.searchQuery = ''; // Clear the search query
          this.markerGroup.clearLayers();
          this.map.setView([40.8, -119.5], 5);
          this.isSliderVisible = false;
          if (this.selectionCircle) {
              this.map.removeLayer(this.selectionCircle);
              this.selectionCircle = null;
          }
          // Any other state resets related to clearing the search
        },
        updateMapMarkers() {
          this.isSliderVisible = true;
          this.markerGroup.clearLayers(); // Clear existing layers from the map
          const currentDate = new Date();
          fetch(this.apiURL, {
            headers: {
              'X-eBirdApiToken': this.apiKey
            }
          })
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            // Assuming data is an array of observations
            this.allObservations = data; // Store fetched observations
            
            if (data.length < 10) {
              this.selectFaraway()
            }
            // Filter observations based on the slider's value
            const filteredObservations = this.allObservations.filter(observation => {
              const obsDate = new Date(observation.obsDt);
              const timeDiff = currentDate - obsDate;
              const daysAgo = timeDiff / (1000 * 3600 * 24);

              // The condition now ensures that as you move the slider to the left (decreasing the value),
              // you start filtering out the newer observations
              return daysAgo >= (30 - this.sliderValue);
            });

            filteredObservations.sort((a, b) => {
              const dateA = new Date(a.obsDt);
              const dateB = new Date(b.obsDt);
              return dateA - dateB; // Compare dates to sort
            });

            // Add circles for filtered observations
            filteredObservations.forEach(observation => {
              const obsDate = new Date(observation.obsDt);
              const currentDate = new Date();
              const timeDiff = currentDate - obsDate;
              const daysAgo = timeDiff / (1000 * 3600 * 24);
              let color;
              // Assign color based on how recent the observation was
              if (daysAgo <= 7.5) {
                color = 'green';
              } else if (daysAgo <= 15) {
                color = 'limegreen';
              } else if (daysAgo <= 22.5) {
                color = 'orange';
              } else {
                color = 'red';
              }

              const popupContent = `Species: ${observation.comName}<br>Date: ${observation.obsDt}<br>Location: ${observation.locName}</br>Bird Info: <a target='_blank' href='https://ebird.org/species/${observation.speciesCode}'>More Info</a>`;
              const circle = new L.CircleMarker([observation.lat, observation.lng], {
                color: color,
                opacity: 0,
                fillColor: color,
                fillOpacity: 0.2,
                radius: 3
              }).bindPopup(popupContent);

              this.markerGroup.addLayer(circle);
              this.map.fitBounds(this.markerGroup.getBounds(), { padding: [10, 10] });
            });
            this.coverScreen = false;
            if (this.coverScreenLat == true) {
              setTimeout(() => {
                // Define the API URL, inserting the selected species code dynamically
                this.latMessage = ''; // Optionally clear or change the message after loading
                this.coverScreenLat = false;
              }, 2000);
              
            }
          })
          .catch(error => {
            console.error('Error fetching data:', error);
            this.coverScreen = false;
          });
        },
        updateMapMarkersSlider() {
          this.isSliderVisible = true;
          this.markerGroup.clearLayers(); // Clear existing layers from the map
          const currentDate = new Date();
                      // Filter observations based on the slider's value
                      const filteredObservations = this.allObservations.filter(observation => {
              const obsDate = new Date(observation.obsDt);
              const timeDiff = currentDate - obsDate;
              const daysAgo = timeDiff / (1000 * 3600 * 24);

              // The condition now ensures that as you move the slider to the left (decreasing the value),
              // you start filtering out the newer observations
              return daysAgo >= (30 - this.sliderValue);
            });

            filteredObservations.sort((a, b) => {
              const dateA = new Date(a.obsDt);
              const dateB = new Date(b.obsDt);
              return dateA - dateB; // Compare dates to sort
            });

            // Add circles for filtered observations
            filteredObservations.forEach(observation => {
              const obsDate = new Date(observation.obsDt);
              const currentDate = new Date();
              const timeDiff = currentDate - obsDate;
              const daysAgo = timeDiff / (1000 * 3600 * 24);
              let color;
              // Assign color based on how recent the observation was
              if (daysAgo <= 7.5) {
                color = 'green';
              } else if (daysAgo <= 15) {
                color = 'limegreen';
              } else if (daysAgo <= 22.5) {
                color = 'orange';
              } else {
                color = 'red';
              }

              const popupContent = `Species: ${observation.comName}<br>Date: ${observation.obsDt}<br>Location: ${observation.locName}`;
              const circle = new L.CircleMarker([observation.lat, observation.lng], {
                color: color,
                opacity: 0,
                fillColor: color,
                fillOpacity: 0.2,
                radius: 3
              }).bindPopup(popupContent);

              this.markerGroup.addLayer(circle);
            });

        },
        selectFaraway() {
          // Define the API URL, inserting the selected species code dynamically
          this.apiURL = `https://api.ebird.org/v2/data/nearest/geo/recent/${this.selectedSpeciesCode}?lat=44.3&lng=-121.2&back=30`;
          this.updateMapMarkers();
        },
        updateMapMarkersLocal() {
            this.migratorNames = [];
            this.isSliderVisible = false;
            this.coverScreen = true; // Show loading overlay
            this.uniqueBirds = new Map();
            this.markerGroup.clearLayers(); // Clear existing markers
            if (this.selectionCircle) {
                this.map.removeLayer(this.selectionCircle);
                this.selectionCircle = null;
            }
            // Add a circle to show the search buffer area
            this.selectionCircle = L.circle([this.latitude, this.longitude], {
                radius: 50000,
                color: 'blue', // Circle border color
                opacity: .2,
                fillOpacity: 0 // Circle fill opacity
            }).addTo(this.map);

            // Fit map bounds to the circle's bounds
            this.map.fitBounds(this.selectionCircle.getBounds());

            fetch(this.apiURL, {
                headers: { 'X-eBirdApiToken': this.apiKey }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                data.forEach(observation => {

                    // Check if bird species is already in the list
                    if (!this.uniqueBirds.has(observation.speciesCode)) {
                        this.uniqueBirds.set(observation.speciesCode, {
                            comName: observation.comName,
                            speciesCode: observation.speciesCode
                        });
                    }
                    // Create and add a marker for each observation
                    const popupContent = `Species: ${observation.comName}<br>Date: ${observation.obsDt}<br>Location: ${observation.locName}</br>Bird Info: <a target='_blank' href='https://ebird.org/species/${observation.speciesCode}'>More Info</a>`;
                    const marker = L.marker([observation.lat, observation.lng]).bindPopup(popupContent);
                    this.markerGroup.addLayer(marker);
                });
                if (!this.birdButtonClick) {
                  this.birdNames = [];
                  this.birdNames = Array.from(this.uniqueBirds.values()).sort((a, b) => a.comName.localeCompare(b.comName));
                }
                this.birdButtonClick = false;
                this.coverScreen = false; // Hide loading overlay
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                this.coverScreen = false;
            });
        },
        updateMapMarkersHotspot() {
            this.migratorNames = [];
            this.isSliderVisible = false;
            this.coverScreen = true; // Show loading overlay
            this.markerGroup.clearLayers(); // Clear existing markers
            if (this.selectionCircle) {
                this.map.removeLayer(this.selectionCircle);
                this.selectionCircle = null;
            }
            this.selectionCircle = L.circle([this.latitude, this.longitude], {
                radius: 20,
                color: 'black', // Circle border color
                opacity: .5,
                fillOpacity: .5 // Circle fill opacity
            }).addTo(this.map);
            this.selectionCircle = L.circle([this.latitude, this.longitude], {
                radius: 50000,
                color: 'blue', // Circle border color
                opacity: .2,
                fillOpacity: 0 // Circle fill opacity
            }).addTo(this.map);


            // Fit map bounds to the circle's bounds
            this.map.fitBounds(this.selectionCircle.getBounds());

            fetch(this.apiURL, {
                headers: { 'X-eBirdApiToken': this.apiKey }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                data.forEach(observation => {
                  if (observation.numSpeciesAllTime <= 50) {
                    color = 'blue';
                    fill = .1
                  } else if (observation.numSpeciesAllTime <= 100) {
                    color = 'blue';
                    fill = .3
                  } else if (observation.numSpeciesAllTime <= 200) {
                    color = 'orange';
                    fill = .4
                  } else {
                    color = 'red';
                    fill = .5
                  }
                    const popupContent = `Location: ${observation.locName}</br>Species Seen: ${observation.numSpeciesAllTime}</br>Location Info: <a target='_blank' href='https://ebird.org/hotspot/${observation.locId}'>More Info</a>`;
                    const marker = new L.CircleMarker([observation.lat, observation.lng], {
                      radius:10,
                      fillColor: color,
                      opacity: 0,
                      fillOpacity: fill
                    }).bindPopup(popupContent);
                    this.markerGroup.addLayer(marker);
                });

                this.coverScreen = false; // Hide loading overlay
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                this.coverScreen = false;
            });
        },
        topMigrators() {
          if (this.migratorNamesMemory.length < 1) {
            //const speciesTest = [{"speciesCode": "comloo","comName": "Common Loon"},{"speciesCode": "commer","comName": "Common Merganser"},{"speciesCode": "commur","comName": "Common Murre"},{"speciesCode": "comnig","comName": "Common Nighthawk"},{"speciesCode": "compoo","comName": "Common Poorwill"},{"speciesCode": "comrav","comName": "Common Raven"},{"speciesCode": "comred","comName": "Common Redpoll"},{"speciesCode": "blksco1","comName": "Common Scoter"}];
            this.fetchProgress = 0;  // Reset progress on function start
            this.totalSpecies = this.speciesArray.length;  // Set total number of species
            const migrationLatObj = {};
            const currentDate = new Date();
            const fetchPromises = this.speciesArray.map(species => {
                this.coverScreenMigrators = true;
                this.apiURL = `https://api.ebird.org/v2/data/obs/US-OR/recent/${species.speciesCode}?back=30&r=US-ID,US-CA,US-NV,US-WA,US-OR`;
                return fetch(this.apiURL, {
                    headers: {
                        'X-eBirdApiToken': this.apiKey
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    this.fetchProgress++;
                    if (data.length > 100 && data.length < 3000) {
                        const oldData = new Set();
                        const newData = new Set();
                        data.forEach(observation => {
                            const obsDate = new Date(observation.obsDt);
                            const timeDiff = currentDate - obsDate;
                            const daysAgo = timeDiff / (1000 * 3600 * 24);
                            if (daysAgo > 20) {
                                oldData.add(observation.lat);
                            } else {
                                newData.add(observation.lat);
                            }
                        });
                        if (oldData.size && newData.size) {
                            const maxOldLat = Math.max(...oldData);
                            const maxNewLat = Math.max(...newData);
                            const latDiff = maxNewLat - maxOldLat;
                            migrationLatObj[species.speciesCode] = {
                              comName: species.comName,
                              latDiff: latDiff,
                              speciesCode: species.speciesCode  // Include speciesCode here
                          };
                        }
                    } else {
                        this.apiURL = `https://api.ebird.org/v2/data/nearest/geo/recent/${species.speciesCode}?lat=44.3&lng=-121.2&back=30`;
                        return fetch(this.apiURL, {
                            headers: {
                                'X-eBirdApiToken': this.apiKey
                            }
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            if (data.length > 100 && data.length < 3000) {
                                const oldData = new Set();
                                const newData = new Set();
                                data.forEach(observation => {
                                    const obsDate = new Date(observation.obsDt);
                                    const timeDiff = currentDate - obsDate;
                                    const daysAgo = timeDiff / (1000 * 3600 * 24);
                                    if (daysAgo > 20) {
                                        oldData.add(observation.lat);
                                    } else {
                                        newData.add(observation.lat);
                                    }
                                });
                                if (oldData.size && newData.size) {
                                    const maxOldLat = Math.max(...oldData);
                                    const maxNewLat = Math.max(...newData);
                                    const latDiff = maxNewLat - maxOldLat;
                                    migrationLatObj[species.speciesCode] = {
                                    comName: species.comName,
                                    latDiff: latDiff,
                                    speciesCode: species.speciesCode  // Include speciesCode here
                                };
                                }
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching data:', error);
                        }); 
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
            });

            Promise.all(fetchPromises).then(() => {
                this.migratorNames = Object.values(migrationLatObj).sort((a, b) => b.latDiff - a.latDiff).slice(0, 10);
                this.migratorNamesMemory = this.migratorNames
                this.topMigratorCalled = true;
                this.coverScreenMigrators = false;
            });
          } else {
            this.migratorNames = this.migratorNamesMemory
            this.birdNames = [];
            this.sliderValue = 30;
            this.searchQuery = ''; // Clear the search query
            this.markerGroup.clearLayers();
            this.map.setView([40.8, -119.5], 5);
            this.isSliderVisible = false;
            if (this.selectionCircle) {
                this.map.removeLayer(this.selectionCircle);
                this.selectionCircle = null;
            }
          }
        },
        topMigratorsListClick(item) {
          const miles = Math.round(item.latDiff*69)
          this.sliderValue = 30;
          this.markerGroup.clearLayers();
          this.selectedSpecies = item.comName;
          this.selectedSpeciesCode = item.speciesCode; // Store the species code
          this.searchQuery = item.comName; // Set the search input to the common name
          this.showOptions = false; // Hide the options list
          this.allObservations = []; // Clear previous observations
          this.latMessage = `Miles travled: ${miles}`; // Set cover message to show latDiff
                    this.coverScreenLat = true;
          this.apiURL = `https://api.ebird.org/v2/data/obs/US-OR/recent/${this.selectedSpeciesCode}?back=30&r=US-ID,US-CA,US-NV,US-WA,US-OR`;
          this.updateMapMarkers();
        }
      }
    });
    </script>
</body>
</html>
